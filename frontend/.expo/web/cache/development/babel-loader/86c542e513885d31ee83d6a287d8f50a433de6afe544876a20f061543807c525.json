{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport { useState, useEffect, useContext } from \"react\";\nimport { sumWordCounts } from \"../../../utils/functions\";\nimport UserContext from '../../../contexts/UserContext';\nimport { useFetchUserData } from \"../../../hooks/useFetchUserData\";\nexport default function useLeaderboardData() {\n  var _useContext = useContext(UserContext),\n    currentUser = _useContext.currentUser;\n  var userData = useFetchUserData('api/users/' + currentUser.user_id + '/following/');\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    leaderboardData = _useState2[0],\n    setLeaderboardData = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    isCutoff = _useState4[0],\n    setIsCutoff = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    currentUserOutsideCutoff = _useState6[0],\n    setCurrentUserOutsideCutoff = _useState6[1];\n  var _useState7 = useState(0),\n    _useState8 = _slicedToArray(_useState7, 2),\n    currentUserIdx = _useState8[0],\n    setCurrentUserIdx = _useState8[1];\n  var cutoffIdx = 3;\n  useEffect(function () {\n    if (userData) {\n      var data = [currentUser].concat(_toConsumableArray(userData)).sort(function (a, b) {\n        return sumWordCounts(b.known_words_count) - sumWordCounts(a.known_words_count);\n      }).slice(-10);\n      var idx = data.findIndex(function (obj) {\n        return obj.user_id === currentUser.user_id;\n      });\n      setCurrentUserIdx(idx);\n      setCurrentUserOutsideCutoff(idx > cutoffIdx);\n      if (data.length > cutoffIdx + 1) {\n        data = data.slice(0, cutoffIdx + 1);\n        setIsCutoff(true);\n      }\n      setLeaderboardData(data);\n    }\n  }, [userData]);\n  return {\n    leaderboardData: leaderboardData,\n    isCutoff: isCutoff,\n    currentUserOutsideCutoff: currentUserOutsideCutoff,\n    currentUserIdx: currentUserIdx\n  };\n}","map":{"version":3,"names":["useState","useEffect","useContext","sumWordCounts","UserContext","useFetchUserData","useLeaderboardData","_useContext","currentUser","userData","user_id","_useState","_useState2","_slicedToArray","leaderboardData","setLeaderboardData","_useState3","_useState4","isCutoff","setIsCutoff","_useState5","_useState6","currentUserOutsideCutoff","setCurrentUserOutsideCutoff","_useState7","_useState8","currentUserIdx","setCurrentUserIdx","cutoffIdx","data","concat","_toConsumableArray","sort","a","b","known_words_count","slice","idx","findIndex","obj","length"],"sources":["C:/Users/Toby Usher/Documents/dev/quivo-app/frontend/screens/AccountScreen/hooks/useLeaderboardData.ts"],"sourcesContent":["import { useState, useEffect, useContext } from \"react\";\r\n// Utils\r\nimport { sumWordCounts } from \"../../../utils/functions\";\r\n// Contexts\r\nimport UserContext from '../../../contexts/UserContext';\r\n// Hooks\r\nimport { useFetchUserData } from \"../../../hooks/useFetchUserData\";\r\n\r\nexport default function useLeaderboardData() {\r\n    const { currentUser } = useContext(UserContext);\r\n\r\n    // Fetches the data for the user's followed accounts using another custom hook\r\n    // and sorts them by streak for the leaderboard, and limit to 10\r\n    const userData = useFetchUserData('api/users/' + currentUser.user_id + '/following/');\r\n    const [leaderboardData, setLeaderboardData] = useState(null);\r\n    const [isCutoff, setIsCutoff] = useState<boolean>(false);\r\n    const [currentUserOutsideCutoff, setCurrentUserOutsideCutoff] = useState<boolean>(false);\r\n    const [currentUserIdx, setCurrentUserIdx] = useState<number>(0);\r\n\r\n    // One less than position\r\n    const cutoffIdx = 3;\r\n    \r\n    useEffect(() => {\r\n        if (userData) {\r\n            \r\n            // Sort by streak\r\n            //const data = [currentUser, ...userData].sort((a, b) => b.streak - a.streak).slice(-10)\r\n\r\n            // Add in current user and sort by total words known\r\n            let data = [currentUser, ...userData].sort(\r\n                (a, b) => sumWordCounts(b.known_words_count) - sumWordCounts(a.known_words_count)\r\n            ).slice(-10)\r\n\r\n            // NOTE: If the user wasn't in the list for whatever reason, this would break\r\n            const idx = data.findIndex(obj => obj.user_id === currentUser.user_id);\r\n            setCurrentUserIdx(idx);\r\n\r\n            // Check if user is outside cutoff\r\n            setCurrentUserOutsideCutoff(idx > cutoffIdx);\r\n\r\n            // Cut down the leaderboard to only the top users in the panel\r\n            if (data.length > cutoffIdx + 1) {\r\n                data = data.slice(0, cutoffIdx + 1);\r\n                setIsCutoff(true);\r\n            }\r\n\r\n            setLeaderboardData(data);\r\n        }\r\n    }, [userData]);\r\n\r\n    return { leaderboardData, isCutoff, currentUserOutsideCutoff, currentUserIdx }\r\n}"],"mappings":";;AAAA,SAASA,QAAQ,EAAEC,SAAS,EAAEC,UAAU,QAAQ,OAAO;AAEvD,SAASC,aAAa,QAAQ,0BAA0B;AAExD,OAAOC,WAAW,MAAM,+BAA+B;AAEvD,SAASC,gBAAgB,QAAQ,iCAAiC;AAElE,eAAe,SAASC,kBAAkBA,CAAA,EAAG;EACzC,IAAAC,WAAA,GAAwBL,UAAU,CAACE,WAAW,CAAC;IAAvCI,WAAW,GAAAD,WAAA,CAAXC,WAAW;EAInB,IAAMC,QAAQ,GAAGJ,gBAAgB,CAAC,YAAY,GAAGG,WAAW,CAACE,OAAO,GAAG,aAAa,CAAC;EACrF,IAAAC,SAAA,GAA8CX,QAAQ,CAAC,IAAI,CAAC;IAAAY,UAAA,GAAAC,cAAA,CAAAF,SAAA;IAArDG,eAAe,GAAAF,UAAA;IAAEG,kBAAkB,GAAAH,UAAA;EAC1C,IAAAI,UAAA,GAAgChB,QAAQ,CAAU,KAAK,CAAC;IAAAiB,UAAA,GAAAJ,cAAA,CAAAG,UAAA;IAAjDE,QAAQ,GAAAD,UAAA;IAAEE,WAAW,GAAAF,UAAA;EAC5B,IAAAG,UAAA,GAAgEpB,QAAQ,CAAU,KAAK,CAAC;IAAAqB,UAAA,GAAAR,cAAA,CAAAO,UAAA;IAAjFE,wBAAwB,GAAAD,UAAA;IAAEE,2BAA2B,GAAAF,UAAA;EAC5D,IAAAG,UAAA,GAA4CxB,QAAQ,CAAS,CAAC,CAAC;IAAAyB,UAAA,GAAAZ,cAAA,CAAAW,UAAA;IAAxDE,cAAc,GAAAD,UAAA;IAAEE,iBAAiB,GAAAF,UAAA;EAGxC,IAAMG,SAAS,GAAG,CAAC;EAEnB3B,SAAS,CAAC,YAAM;IACZ,IAAIQ,QAAQ,EAAE;MAMV,IAAIoB,IAAI,GAAG,CAACrB,WAAW,EAAAsB,MAAA,CAAAC,kBAAA,CAAKtB,QAAQ,GAAEuB,IAAI,CACtC,UAACC,CAAC,EAAEC,CAAC;QAAA,OAAK/B,aAAa,CAAC+B,CAAC,CAACC,iBAAiB,CAAC,GAAGhC,aAAa,CAAC8B,CAAC,CAACE,iBAAiB,CAAC;MAAA,CACrF,CAAC,CAACC,KAAK,CAAC,CAAC,EAAE,CAAC;MAGZ,IAAMC,GAAG,GAAGR,IAAI,CAACS,SAAS,CAAC,UAAAC,GAAG;QAAA,OAAIA,GAAG,CAAC7B,OAAO,KAAKF,WAAW,CAACE,OAAO;MAAA,EAAC;MACtEiB,iBAAiB,CAACU,GAAG,CAAC;MAGtBd,2BAA2B,CAACc,GAAG,GAAGT,SAAS,CAAC;MAG5C,IAAIC,IAAI,CAACW,MAAM,GAAGZ,SAAS,GAAG,CAAC,EAAE;QAC7BC,IAAI,GAAGA,IAAI,CAACO,KAAK,CAAC,CAAC,EAAER,SAAS,GAAG,CAAC,CAAC;QACnCT,WAAW,CAAC,IAAI,CAAC;MACrB;MAEAJ,kBAAkB,CAACc,IAAI,CAAC;IAC5B;EACJ,CAAC,EAAE,CAACpB,QAAQ,CAAC,CAAC;EAEd,OAAO;IAAEK,eAAe,EAAfA,eAAe;IAAEI,QAAQ,EAARA,QAAQ;IAAEI,wBAAwB,EAAxBA,wBAAwB;IAAEI,cAAc,EAAdA;EAAe,CAAC;AAClF"},"metadata":{},"sourceType":"module","externalDependencies":[]}